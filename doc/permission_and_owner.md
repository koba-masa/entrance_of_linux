# ファイルのアクセス権と所有権

- ファイルやディレクトリは作成すると、以下の情報が付与される
  - 所有者: 作成したユーザ
  - グループ: 所有者のプライマリグループ
  - アクセス権:
    - ファイル: `666`からumask値を引いた値
    - ディレクトリ: `777`からumask値を引いた値

  ```sh
  [testuser@localhost ~]$ umask
  0002
  [testuser@localhost ~]$ touch sample.txt
  [testuser@localhost ~]$ ls -l sample.txt
  -rw-rw-r--. 1 testuser testuser 0 12月 31 21:51 sample.txt
  [testuser@localhost ~]$
  ```

## 権限の確認
- `ls -l`にて確認をする
![ファイルのアクセス権と所有権](/images/permission_and_owner/01.png)

### ファイルの種別
|種別|概要|
|:--|:--|
|`d`|ディレクトリ|
|`-`|ファイル|
|`l`|シンボリックリンク|

### アクセス権(パーミッション)
- 合計値を8進数で表現する(例：`rw-`→`110`→`6`)

  |種別|概要|2進数|8進数|
  |:--|:--|:--:|:--:|
  |`r`|読み込み権限|`100`|`4`|
  |`w`|書き込み権限|`010`|`2`|
  |`x`|実行権限|`001`|`1`|

#### ファイルとディレクトリにおける権限
|種別|概要|ファイル|ディレクトリ|
|:--|:--|:--|:--|
|`r`|読み込み権限|ファイルを参照が可能|ディレクトリ配下のファイル一覧の取得が可能|
|`w`|書き込み権限|ファイルを更新が可能|ディレクトリ配下にファイル、ディレクトリの作成が可能|
|`x`|実行権限|ファイルを実行が可能|ディレクトリに移動が可能|

## 権限の変更
```sh
chmod 764 sample.txt
```

## 所有権の変更
- 所有者を変更する
  ```sh
  chown root sample.txt
  ```
- グループを変更する
  ```sh
  chgrp root sample.txt
  ```
- 所有者とグループを変更する
  ```sh
  chown testuser:testuser sample.txt
  ```

## sudo
アクセス権を持たないファイルを編集するためには権限を持つユーザにログインし、作業する必要がある。<br>
rootユーザであれば、なんでもできるが、逆に操作ミスによる事故の発生も増える。<br>
それを防ぐために、`sudo`コマンドが用意されている。

```sh
sudo chmod 777 sample.txt
```

`/etc/sudoers`ファイルを編集し、ユーザにroot権限で実行できることを許可する。<br>
※編集にはrootユーザで以下のコマンドを実行し、行う。

```sh
visudo
```

書式: `ユーザ名	ホスト名=(実行ユーザ名)	[NOPASSWD:]コマンド`

|項目|概要|備考|
|:--|:--|:--|
|ユーザ名|コマンドの実行を許可するユーザ名、グループ名、ALL||
|ホスト名|実行を許可するホスト名、IPアドレス、もしくはALL||
|実行ユーザ|コマンド実行時のユーザ、もしくはALL|省略するとroot|
|NOPASSWD:|指定するとパスワードの入力が不要となる||
|コマンド|許可するコマンドのパス、もしくはALL||

- 例: `testuser`に`chmod`の権限をパスワードなしで許可する<br>
  - `testuser	ALL=(ALL) NOPASSWD:/usr/bin/chmod`

### 与えられている権限の確認
`/etc/sudoers`はrootユーザのみ参照が可能なため、一般ユーザは以下のコマンドを実行し、権限を確認する
```sh
sudo -l
```
